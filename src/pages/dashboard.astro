---
import Layout from '../layouts/Layout.astro';
import { RelatedPapers } from '../components/dashboard';
import { TopicAnalysisChart } from '../components/dashboard/TopicAnalysisChart';
import { TemporalAnalysisChart } from '../components/dashboard/TemporalAnalysisChart';

// Simplified mock data
const mockTopicData = [
  { id: 'topic1', name: 'Machine Learning', count: 150, keywords: [['neural networks', 45], ['deep learning', 38]] },
  { id: 'topic2', name: 'Computer Vision', count: 120, keywords: [['image processing', 42], ['object detection', 35]] },
  { id: 'topic3', name: 'Natural Language', count: 95, keywords: [['language models', 40], ['text analysis', 33]] },
  { id: 'topic4', name: 'Robotics', count: 80, keywords: [['autonomous systems', 35], ['control', 28]] },
  { id: 'topic5', name: 'Data Science', count: 110, keywords: [['statistics', 38], ['visualization', 30]] },
  { id: 'topic6', name: 'Artificial Intelligence', count: 200, keywords: [['ai systems', 50], ['intelligence', 45]] },
];

const mockAnalysisData = {
  topics: {
    data: {
      topic1: { name: 'Machine Learning', keywords: [['neural networks', 45]], count: 150 },
      topic2: { name: 'Computer Vision', keywords: [['image processing', 42]], count: 120 },
      topic3: { name: 'Natural Language', keywords: [['language models', 40]], count: 95 },
      topic4: { name: 'Robotics', keywords: [['autonomous systems', 35]], count: 80 },
      topic5: { name: 'Data Science', keywords: [['statistics', 38]], count: 110 },
      topic6: { name: 'Artificial Intelligence', keywords: [['ai systems', 50]], count: 200 },
    },
    series: {
      '2020': [10, 8, 6, 4, 7, 12],
      '2021': [15, 12, 9, 6, 10, 18],
      '2022': [20, 16, 12, 8, 13, 24],
      '2023': [25, 20, 15, 10, 16, 30],
      '2024': [30, 24, 18, 12, 19, 36],
    }
  }
};

const mockRelatedPapers = [
  {
    id: 'paper1',
    title: 'Deep Learning Approaches for Natural Language Processing',
    authors: ['John Smith', 'Jane Doe'],
    year: 2023,
    citations: 245,
    abstract: 'This paper presents novel deep learning techniques for improving natural language processing tasks...',
    topics: ['Deep Learning', 'NLP']
  },
  {
    id: 'paper2',
    title: 'Computer Vision Applications in Autonomous Vehicles',
    authors: ['Alice Brown', 'Charlie Wilson'],
    year: 2023,
    citations: 189,
    abstract: 'We explore the application of computer vision algorithms in autonomous vehicle systems...',
    topics: ['Computer Vision', 'Autonomous Systems']
  },
  {
    id: 'paper3',
    title: 'Reinforcement Learning for Game AI',
    authors: ['David Lee', 'Emma Davis'],
    year: 2022,
    citations: 156,
    abstract: 'This research investigates reinforcement learning methods for creating intelligent game AI...',
    topics: ['Reinforcement Learning', 'Game AI']
  }
];
---

<Layout title="Dashboard - PaperTrends Research Analysis" canonical="/dashboard">
  <main class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <!-- Header Section -->
    <section class="bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800">
      <div class="max-w-[90%] mx-auto px-6 sm:px-8 lg:px-12">
        <!-- Page Header -->
        <div class="py-4">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <!-- Title Section -->
            <div class="flex items-center space-x-3">
              <div class="w-6 h-6 bg-gray-900 dark:bg-white rounded-md flex items-center justify-center">
                <svg class="w-3 h-3 text-white dark:text-gray-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
              </div>
              <div>
                <h1 class="text-lg font-medium text-gray-900 dark:text-white tracking-tight">
                  Dashboard
                </h1>
                <p class="text-xs text-gray-500 dark:text-gray-400 font-normal">
                  Research analytics
                </p>
              </div>
            </div>
            
            <!-- Statistics Cards -->
            <div class="grid grid-cols-2 sm:flex sm:flex-wrap sm:items-center gap-3 sm:gap-4">
              <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-3 min-w-[100px] h-[70px] flex flex-col justify-between">
                <div class="flex items-center space-x-2">
                  <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                  <span class="text-xs text-gray-600 dark:text-gray-400 font-medium">Papers</span>
                </div>
                <div class="text-lg font-semibold text-gray-900 dark:text-white">88,303</div>
              </div>
              
              <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-3 min-w-[100px] h-[70px] flex flex-col justify-between">
                <div class="flex items-center space-x-2">
                  <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
                  <span class="text-xs text-gray-600 dark:text-gray-400 font-medium">Topics</span>
                </div>
                <div class="text-lg font-semibold text-gray-900 dark:text-white">48</div>
              </div>
              
              <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-3 min-w-[140px] h-[70px] flex flex-col justify-between">
                <div class="flex items-center space-x-2">
                  <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                  <span class="text-xs text-gray-600 dark:text-gray-400 font-medium">Period</span>
                </div>
                <div class="text-sm font-semibold text-gray-900 dark:text-white">2020-01 - 2025-09</div>
              </div>
              
              <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-3 min-w-[100px] h-[70px] flex flex-col justify-between">
                <div class="flex items-center space-x-2">
                  <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                  <span class="text-xs text-gray-600 dark:text-gray-400 font-medium">Updated</span>
                </div>
                <div class="text-sm font-semibold text-gray-900 dark:text-white">Sep 26</div>
                <div class="text-xs text-gray-500 dark:text-gray-400">v0.0.2</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Content Layout -->
    <div class="max-w-[90%] mx-auto px-6 sm:px-8 lg:px-12 py-6">
      <!-- Main Content -->
      <div class="w-full">
          <div class="space-y-6">
            <!-- First Row: Topic Analysis and Temporal Analysis -->
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
              <!-- Left Column: Topic Analysis (2/5) -->
              <div class="lg:col-span-2">
                <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 h-full">
                  <div class="mb-4">
                    <h2 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
                      Topic Analysis
                    </h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                      Explore research topic relationships and clustering patterns
                    </p>
                  </div>
                  
                  <!-- D3 Chart Container - Responsive -->
                  <div class="w-full h-72 sm:h-80 md:h-96 lg:h-[400px] xl:h-[450px]">
                    <TopicAnalysisChart 
                      data={mockTopicData} 
                      client:load
                    />
                  </div>
                </div>
              </div>

              <!-- Right Column: Temporal Analysis (3/5) -->
              <div class="lg:col-span-3">
                <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 h-full">
                  <div class="mb-4">
                    <h2 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
                      Temporal Analysis
                    </h2>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                      Track research evolution and emerging trends over time
                    </p>
                  </div>
                  
                  <!-- Chart and Legend Layout -->
                  <div class="flex flex-col lg:flex-row lg:gap-4">
                    <!-- Chart Container -->
                    <div class="w-full lg:w-4/5">
                      <div class="w-full h-72 sm:h-80 md:h-96 lg:h-[400px] xl:h-[450px]">
                        <TemporalAnalysisChart 
                          data={mockAnalysisData} 
                          client:load
                        />
                      </div>
                    </div>
                    
                    <!-- Desktop Legend (Right Side) -->
                    <div class="hidden lg:block lg:w-1/5">
                      <div class="h-72 sm:h-80 md:h-96 lg:h-[400px] xl:h-[450px] flex flex-col justify-start pt-4">
                        <div class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-3">Topics</div>
                        <div class="space-y-2">
                          <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 rounded-full" style="background-color: #1f77b4;"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Machine Learning</span>
                          </div>
                          <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 rounded-full" style="background-color: #ff7f0e;"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Computer Vision</span>
                          </div>
                          <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 rounded-full" style="background-color: #2ca02c;"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Natural Language</span>
                          </div>
                          <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 rounded-full" style="background-color: #d62728;"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Robotics</span>
                          </div>
                          <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 rounded-full" style="background-color: #9467bd;"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">Data Science</span>
                          </div>
                          <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 rounded-full" style="background-color: #8c564b;"></div>
                            <span class="text-xs text-gray-600 dark:text-gray-400">AI</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Mobile/Tablet Legend (Below Chart) -->
                  <div class="block lg:hidden mt-4">
                    <div class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-3">Topics</div>
                    <!-- Horizontal Scrollable Legend -->
                    <div class="legend-scroll">
                      <style>
                        /* Custom scrollbar for webkit browsers */
                        .legend-scroll::-webkit-scrollbar {
                          height: 6px;
                        }
                        .legend-scroll::-webkit-scrollbar-track {
                          background: rgb(229, 231, 235);
                        }
                        .legend-scroll::-webkit-scrollbar-thumb {
                          background: rgb(156, 163, 175);
                          border-radius: 3px;
                        }
                        .legend-scroll::-webkit-scrollbar-thumb:hover {
                          background: rgb(107, 114, 128);
                        }
                        /* Dark mode scrollbar */
                        .dark .legend-scroll::-webkit-scrollbar-track {
                          background: rgb(31, 41, 55);
                        }
                        .dark .legend-scroll::-webkit-scrollbar-thumb {
                          background: rgb(107, 114, 128);
                        }
                        .dark .legend-scroll::-webkit-scrollbar-thumb:hover {
                          background: rgb(156, 163, 175);
                        }
                      </style>
                      <!-- Multi-line Legend Grid -->
                      <div class="grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-3 pb-2 w-full">
                        <div class="flex items-center space-x-2">
                          <div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: #1f77b4;"></div>
                          <span class="text-xs text-gray-600 dark:text-gray-400">Machine Learning</span>
                        </div>
                        <div class="flex items-center space-x-2">
                          <div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: #ff7f0e;"></div>
                          <span class="text-xs text-gray-600 dark:text-gray-400">Computer Vision</span>
                        </div>
                        <div class="flex items-center space-x-2">
                          <div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: #2ca02c;"></div>
                          <span class="text-xs text-gray-600 dark:text-gray-400">Natural Language</span>
                        </div>
                        <div class="flex items-center space-x-2">
                          <div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: #d62728;"></div>
                          <span class="text-xs text-gray-600 dark:text-gray-400">Robotics</span>
                        </div>
                        <div class="flex items-center space-x-2">
                          <div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: #9467bd;"></div>
                          <span class="text-xs text-gray-600 dark:text-gray-400">Data Science</span>
                        </div>
                        <div class="flex items-center space-x-2">
                          <div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: #8c564b;"></div>
                          <span class="text-xs text-gray-600 dark:text-gray-400">AI</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Second Row: Representative Papers (Full Width) -->
            <div class="w-full">
              <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                <div class="mb-4">
                  <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
                    Representative Papers
                  </h3>
                  <p class="text-sm text-gray-600 dark:text-gray-400">
                    Recent papers in AI Systems & Human Intelligence
                  </p>
                </div>
                <RelatedPapers papers={mockRelatedPapers} />
              </div>
            </div>
          </div>
      </div>
    </div>
  </main>
</Layout>
